#!/bin/bash

CONFIG=~/src/freqtrade-strategies/config.json
DATA_DIR=~/src/freqtrade/user_data/data/binance
HYPEROPT_LOSS=SharpeHyperOptLossDaily
HYPEROPT_PATH=~/src/freqtrade-strategies/hyperopts
STRATEGY_PATH=~/src/freqtrade-strategies/strategies
USER_DATA_DIR=~/src/freqtrade/user_data


# Parameters
# ----------
#
# v: Path to Python virtual environment activation script
# t: Flag for trade mode
# b: Flag for backtesting mode
# h: Flag for hypertopt mode
# s: Strategy class name
# h: Hyperopt class name
# l: Hyperopt loss class name (optional)
#
# TODO: Help
#
while getopts "v:tbhs:h:l:" o;
do
  case "${o}" in
    v)
      # Activate e.g. a virtual env
      # Must be the first argument
      source ${OPTARG}
      ;;
    s)
      strategy=${OPTARG}
      ;;
    h)
      hyperopt=${OPTARG}
      ;;
    l)
      hyperopt_loss=${OPTARG}
      ;;
    t)
      freqtrade trade \
        --config $CONFIG \
        --datadir $DATA_DIR \
        --strategy $strategy \
        --strategy-path $STRATEGY_PATH \
        --user-data-dir $USER_DATA_DIR
      ;;
    b)
      freqtrade backtesting \
        --config $CONFIG \
        --datadir $DATA_DIR \
        --export t \
        --strategy "$strategy" \
        --strategy-path $STRATEGY_PATH \
        --user-data-dir $USER_DATA_DIR
      ;;
    h)
      freqtrade hyperopt \
        --config $CONFIG \
        --datadir $DATA_DIR \
        --hyperopt-path $HYPEROPT_PATH \
        --hyperopt "$hyperopt" \
        --hyperopt-loss "${hyperopt_loss:-HYPEROPT_LOSS}" \
        --strategy "$strategy" \
        --strategy-path $STRATEGY_PATH \
        --user-data-dir $USER_DATA_DIR
      ;;
  esac
done

